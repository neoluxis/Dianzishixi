C51 COMPILER V9.60.7.0   MAIN                                                              04/02/2024 09:45:06 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN main.OBJ
COMPILER INVOKED BY: D:\Keil_v5\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND TABS(2)

line level    source

   1          //-----------------------------------------------------------------------------//
   2          //---------心率仪语音播报C51程序框架---by tjx----------------------------------//
   3          //---------------------2023.04-------------------------------------------------//
   4          //------------------crystal=6MHz-----------------------------------------------//
   5          //-----------------------------------------------------------------------------//
   6          
   7          //-----------------------------------------------------------------------------//
   8          //包含头文件、定义各个接口-----------------------------------------------------//
   9          //-----------------------------------------------------------------------------//
  10          #include <AT89X52.H>
  11          #define  uint  unsigned int  //定义一下方便编程
  12          #define  uchar unsigned char //定义一下方便编程
  13          #define  keystart       P1_0 //定义测量开始启动按钮口
  14          #define  SOUND_RESET    P1_6 //定义语音芯片复位口
  15          #define  SOUND_DATA     P1_5 //定义语音芯片数据口
  16          #define  SOUND_BUSY     P1_4 //定义语音芯片忙碌口
  17          uint     heartrate=123;      //定义心率值变量并赋初值     
  18          uchar    ge,shi,bai;       //定义个位、十位、百位要显示、播报的数值
  19          
  20          
  21          
  22          //-----------------------------------------------------------------------------//
  23          //函数声明---------------------------------------------------------------------//
  24          //-----------------------------------------------------------------------------//
  25          void delay1ms(uint count);        //毫秒级延时（不是很准）
  26          void sound_reset(void);       //复位语音芯片
  27          void speek(unsigned char num);    //播报地址对应的声音
  28          void speekone(void);        //播报一声“叮”
  29          void speekheartrate(void);        //播报心率值
  30          
  31          //-----------------------------------------------------------------------------//
  32          //主函数，开机报报叮叮咚咚的声音-----------------------------------------------//
  33          //-----------------------------------------------------------------------------//
  34          void main(void)
  35          { int idx = 0;
  36   1        for (idx=0; idx<256;idx++)
  37   1         speek(idx);
  38   1        speek(1);                    //开机播报“叮叮咚咚”的声音
  39   1          while(1)
  40   1        {
  41   2      //    if(keystart==0)
  42   2      //    {
  43   2      //      delay1ms(80);
  44   2      //    if(keystart==0)
  45   2      //    {
  46   2      //      speekone();
  47   2      //      bai=heartrate/100;       //计算百位数值
  48   2      //        shi=(heartrate/10)%10;   //计算十位数值
  49   2      //        ge=heartrate%10;     //计算个位数值
  50   2      //      speekheartrate();        //播报心率值（需补全该函数）
  51   2      //    } 
  52   2      //    }
  53   2        }
  54   1          
  55   1      }
C51 COMPILER V9.60.7.0   MAIN                                                              04/02/2024 09:45:06 PAGE 2   

  56          
  57          //-----------------------------------------------------------------------------//
  58          //延时1ms的函数----------------------------------------------------------------//
  59          //-----------------------------------------------------------------------------//
  60          void delay1ms(uint count)
  61              { 
  62   1           int m,n;
  63   1           for(m=0;m<count;m++)
  64   1           for(n=0;n<59;n++)
  65   1           ;
  66   1          }
  67          /*以下为语音芯片复位的函数*/
  68          void sound_reset(void)
  69          {
  70   1         SOUND_RESET=1;
  71   1         delay1ms(2);
  72   1         SOUND_RESET=0;
  73   1         delay1ms(2);
  74   1      }
  75          /*以下为播报某个地址声音的函数*/ 
  76          void speek(unsigned char num)
  77          {
  78   1        unsigned char i=0;
  79   1        while(SOUND_BUSY==0);
  80   1        sound_reset();
  81   1        if((num>=0)&&(num<=9))
  82   1        {
  83   2          for(i=0;i<num+2;i++)
  84   2          {
  85   3            SOUND_DATA=1;
  86   3            delay1ms(1);
  87   3            SOUND_DATA=0;
  88   3          delay1ms(1);
  89   3          }
  90   2        }
  91   1        else
  92   1        {
  93   2          for(i=0;i<num;i++)
  94   2          {
  95   3            SOUND_DATA=1;
  96   3            delay1ms(1);
  97   3            SOUND_DATA=0;
  98   3          delay1ms(1);
  99   3          }
 100   2        }
 101   1      }
 102          /*以下为播报“叮――”的函数*/
 103          void speekone(void)
 104          {
 105   1        while(SOUND_BUSY==0);
 106   1        speek(33);
 107   1      }
 108          /*以下为播报心率值的函数*/
 109          void speekheartrate(void)
 110          {
 111   1        //后面的自己补全
 112   1        //播报百位
 113   1        //播报十位
 114   1        //播报个位
 115   1      }
 116          //-----------------------------------------------------------------------------//
 117          //程序完毕---------------------------------------------------------------------//
C51 COMPILER V9.60.7.0   MAIN                                                              04/02/2024 09:45:06 PAGE 3   

 118          //-----------------------------------------------------------------------------//
 119          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    171    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      5       3
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
